<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="UTF-8">
<title>NOVA translator pro</title>

<style>
/* ---------- BASE ---------- */
:root {
  --bg: #0a0a0c;
  --gold: #FFD700;
  --deepGold: #C6A400;
  --glass: rgba(255,255,255,0.08);
}
* { box-sizing:border-box; }
body {
  margin:0;
  background:var(--bg);
  color:white;
  font-family: Arial;
  -webkit-font-smoothing:antialiased;
}

/* TOP NAV */
#topbar {
  position: fixed;
  left:0; right:0; top:0;
  height:64px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:0 20px;
  background: rgba(0,0,0,0.3);
  border-bottom:1px solid rgba(255,255,255,0.1);
  backdrop-filter: blur(8px);
  z-index:50;
}
#topbar .brand {
  font-size:20px;
  font-weight:900;
  color:var(--gold);
}
#topbar nav a {
  color:rgba(255,255,255,0.8);
  margin-left:20px;
  text-decoration:none;
  font-weight:600;
}
#topbar nav a:hover { color:var(--gold); }

/* PAGE WRAPPER */
.page {
  display:none;
  padding-top:90px;
  padding-left:20px;
  padding-right:20px;
}

/* SIDEBAR + HISTORY */
#sidebar {
  position:fixed;
  left:12px; top:84px;
  width:110px; height:calc(100% - 110px);
  background:var(--glass);
  border-right:2px solid var(--gold);
  backdrop-filter:blur(18px);
  display:flex;
  flex-direction:column;
  gap:14px;
  padding:18px;
  border-radius:12px;
  z-index:40;
}
#sidebar button {
  padding:10px;
  background:rgba(255,255,255,0.08);
  color:var(--gold);
  border:1px solid rgba(255,255,255,0.05);
  border-radius:10px;
  cursor:pointer;
  font-weight:700;
}
#sidebar .danger {
  background:#7b0000;
  border-color:#4a0000;
}

/* HISTORY PANEL */
#historyPanel {
  position:fixed;
  right:-380px; top:0;
  width:360px; height:100vh;
  background:rgba(255,255,255,0.06);
  border-left:2px solid var(--gold);
  backdrop-filter:blur(20px);
  padding:20px;
  transition:0.45s;
  z-index:80;
}
#historyPanel.show { right:0; }
#historyList { height:88%; overflow-y:auto; margin-top:20px; }
.historyItem {
  background:rgba(0,0,0,0.45);
  padding:12px;
  border-radius:10px;
  margin-bottom:12px;
  border:1px solid rgba(255,255,255,0.1);
}

/* TEXTBOXES + BUTTONS */
textarea, input, select {
  background:rgba(255,255,255,0.07);
  border:1px solid rgba(255,255,255,0.1);
  color:var(--gold);
  border-radius:10px;
  padding:12px;
  width:100%;
  margin-top:10px;
}
textarea { min-height:160px; resize:vertical; }

button {
  background:var(--gold);
  color:black;
  padding:10px 16px;
  border-radius:10px;
  border:none;
  cursor:pointer;
  font-weight:700;
  margin-top:14px;
}
button.muted {
  background:rgba(255,255,255,0.1);
  color:var(--gold);
}

/* CARD */
.card {
  background:rgba(255,255,255,0.07);
  backdrop-filter:blur(14px);
  border:1px solid rgba(255,255,255,0.1);
  padding:20px;
  border-radius:14px;
  max-width:700px;
  margin:auto;
}

/* CENTER */
.center {
  display:flex;
  justify-content:center;
  padding-top:100px;
}

/* LOGIN OVERLAY */
#loginScreen {
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.8);
  backdrop-filter:blur(12px);
  display:flex;
  justify-content:center;
  align-items:center;
  z-index:99;
}
.loginBox {
  background:rgba(255,255,255,0.1);
  padding:30px;
  border-radius:12px;
  border:1px solid var(--gold);
  width:320px;
  text-align:center;
}
.loginBox input { margin-top:12px; }
.small { font-size:13px; opacity:0.7; }
.link { color:var(--gold); text-decoration:none; }
</style>

</head>

<body>

<!-- TOP NAV -->
<div id="topbar">
  <div class="brand">NOVA</div>
  <nav>
    <a href="#" onclick="openPage('translate')">Translate</a>
    <a href="#" onclick="openPage('ocr')">OCR</a>
    <a href="#" onclick="openPage('speech')">Speech→Text</a>
    <a href="#" onclick="openPage('settings')">Settings</a>
    <a href="#" onclick="openPage('devices')">Devices</a>
    <a href="#" onclick="openPage('signup')">Signup</a>
  </nav>
</div>

<!-- SIDEBAR -->
<div id="sidebar">
  <button onclick="toggleHistory()">History</button>
  <button class="danger" onclick="logout()">Logout</button>
</div>

<!-- HISTORY PANEL -->
<div id="historyPanel">
  <h2>History</h2>
  <div id="historyList"></div>
</div>

<!-- LOGIN SCREEN -->
<div id="loginScreen">
  <div class="loginBox">
    <h2>Login</h2>
    <input id="login_email" type="email" placeholder="Email">
    <input id="login_password" type="password" placeholder="Password">
    <button onclick="login()">Login</button>
    <button class="muted" onclick="demoLogin()">Demo</button>
    <p id="loginError" class="small"></p>
    <p class="small">No account? <a class="link" href="#" onclick="openPage('signup')">Signup</a></p>
  </div>
</div>

<!-- TRANSLATE PAGE -->
<div class="page" id="page_translate">
  <h1>Translator</h1>
  <textarea id="tr_input" placeholder="Enter text..."></textarea>
  <select id="tr_lang">
    <option value="en">English</option>
    <option value="hi">Hindi</option>
    <option value="fr">French</option>
    <option value="es">Spanish</option>
  </select>
  <button onclick="translateText()">Translate</button>
  <textarea id="tr_output" readonly></textarea>
</div>

<!-- SIGNUP PAGE -->
<div class="page center" id="page_signup">
  <div class="card">
    <h2>Create Account</h2>
    <input id="su_email" type="email" placeholder="Email">
    <input id="su_username" type="text" placeholder="Username">
    <input id="su_password" type="password" placeholder="Password (min 6)">
    <button onclick="signup()">Signup</button>
    <p id="su_msg" class="small"></p>
  </div>
</div>

<!-- OCR PAGE -->
<div class="page center" id="page_ocr">
  <div class="card">
    <h2>OCR — Image → Text</h2>
    <input id="ocrFile" type="file" accept="image/*">
    <button onclick="doOCR()">Extract</button>
    <textarea id="ocrOutput" readonly></textarea>
    <p id="ocrMsg" class="small"></p>
  </div>
</div>

<!-- SPEECH PAGE -->
<div class="page center" id="page_speech">
  <div class="card">
    <h2>Speech → Text</h2>
    <input id="speechFile" type="file" accept="audio/*">
    <button onclick="doSpeech()">Convert</button>
    <textarea id="speechOutput" readonly></textarea>
    <p id="speechMsg" class="small"></p>
  </div>
</div>

<!-- SETTINGS PAGE -->
<div class="page center" id="page_settings">
  <div class="card">
    <h2>Settings</h2>
    <label>Theme</label>
    <select id="set_theme">
      <option value="">Default</option>
      <option value="dark">Dark</option>
      <option value="amoled">Amoled</option>
    </select>
    <label>Favorites (comma separated)</label>
    <input id="set_fav" type="text">
    <button onclick="saveSettings()">Save</button>
    <button class="muted" onclick="loadSettings()">Load</button>
    <p id="settingsMsg" class="small"></p>
  </div>
</div>

<!-- DEVICES PAGE -->
<div class="page center" id="page_devices">
  <div class="card">
    <h2>Devices</h2>
    <div id="devicesList"></div>
    <p id="devicesMsg" class="small"></p>
  </div>
</div>

<script>
// BACKEND URL
const API = "https://adolfo-blondish-sublaryngeally.ngrok-free.dev";

// SIMPLE helpers
function setToken(t){ localStorage.setItem("token", t); }
function getToken(){ return localStorage.getItem("token"); }
function logout(){ localStorage.removeItem("token"); location.reload(); }

function openPage(p){
  document.querySelectorAll(".page").forEach(pg=>pg.style.display="none");
  document.getElementById("page_"+p).style.display="block";
}

// history
function toggleHistory(){
  document.getElementById("historyPanel").classList.toggle("show");
}

// LOGIN
async function login(){
  const email = login_email.value.trim();
  const password = login_password.value;

  const r = await fetch(API+"/login", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({
      email,password,
      device_fingerprint:"web",
      user_agent:navigator.userAgent,
      device_model:"Browser",
      device_os:navigator.platform,
      browser:"Web",
      screen_width:window.innerWidth,
      screen_height:window.innerHeight
    })
  });
  const j = await r.json();
  if(j.token){
    setToken(j.token);
    document.getElementById("loginScreen").style.display="none";
    loadHistory();
  } else loginError.textContent = j.error || "Login failed";
}
async function demoLogin(){
  const r = await fetch(API+"/demo",{method:"POST"});
  const j=await r.json();
  if(j.token){
    setToken(j.token);
    document.getElementById("loginScreen").style.display="none";
    loadHistory();
  }
}

// SIGNUP
async function signup(){
  const email = su_email.value.trim();
  const user = su_username.value.trim();
  const pass = su_password.value;
  const msg = document.getElementById("su_msg");
  if(!email || !user || !pass){ msg.textContent="All fields required"; return; }

  const r = await fetch(API+"/signup",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ email,username:user,password:pass })
  });
  const j=await r.json();
  if(j.message || r.status===201){
    msg.textContent="Signup successful! Login now.";
  } else msg.textContent=j.error || "Error";
}

// TRANSLATION
async function translateText(){
  const text = tr_input.value.trim();
  const lang = tr_lang.value;
  const r = await fetch(API+"/translate",{
    method:"POST",
    headers:{
      "Content-Type":"application/json",
      "Authorization":"Bearer "+getToken()
    },
    body:JSON.stringify({ text, target_lang:lang })
  });
  const j=await r.json();
  tr_output.value = j.translated_text || j.error || "Error";
  loadHistory();
}

// HISTORY
async function loadHistory(){
  const r = await fetch(API+"/history",{
    headers:{ "Authorization":"Bearer "+getToken() }
  });
  const j = await r.json();
  historyList.innerHTML="";
  j.history?.forEach(h=>{
    let div=document.createElement("div");
    div.className="historyItem";
    div.innerHTML=`<p>${h.input_text}</p><p style="color:var(--gold)">${h.output_text}</p>`;
    historyList.appendChild(div);
  });
}

// OCR
async function doOCR(){
  const f = document.getElementById("ocrFile").files[0];
  if(!f){ ocrMsg.textContent="Select image"; return; }
  const form=new FormData(); form.append("image",f);
  const r=await fetch(API+"/ocr",{ method:"POST", headers:{ "Authorization":"Bearer "+getToken() }, body:form });
  const j=await r.json();
  ocrOutput.value=j.extracted_text||j.error||"Error";
}

// SPEECH
async function doSpeech(){
  const f = document.getElementById("speechFile").files[0];
  if(!f){ speechMsg.textContent="Select audio"; return; }
  const form=new FormData(); form.append("audio",f);
  const r=await fetch(API+"/speech_to_text",{ method:"POST", headers:{ "Authorization":"Bearer "+getToken() }, body:form });
  const j=await r.json();
  speechOutput.value=j.text||j.error||"Error";
}

// SETTINGS
async function saveSettings(){
  const theme = set_theme.value;
  const fav = set_fav.value;
  const r = await fetch(API+"/settings",{
    method:"POST",
    headers:{ "Content-Type":"application/json","Authorization":"Bearer "+getToken() },
    body:JSON.stringify({ theme, recent_langs:fav.split(','), favorites:fav })
  });
  const j=await r.json();
  settingsMsg.textContent=j.message||j.error;
}
async function loadSettings(){
  const r = await fetch(API+"/settings",{ headers:{ "Authorization":"Bearer "+getToken() } });
  const j=await r.json();
  if(j.settings){
    set_theme.value = j.settings.theme||"";
    set_fav.value = (j.settings.favorites || j.settings.recent_langs||[]).join(", ");
    settingsMsg.textContent="Loaded";
  }
}

// DEVICES
async function loadDevices(){
  const r = await fetch(API+"/sessions",{ headers:{ "Authorization":"Bearer "+getToken() } });
  const j = await r.json();
  devicesList.innerHTML="";
  j.sessions?.forEach(s=>{
    let div=document.createElement("div");
    div.className="historyItem";
    div.innerHTML=`
      <p>${s.browser||s.user_agent}</p>
      <p style="color:var(--gold)">${s.ip||""}</p>
      <button onclick="removeDevice('${s.session_id}')">Remove</button>
    `;
    devicesList.appendChild(div);
  });
}
async function removeDevice(id){
  const r=await fetch(API+"/sessions/delete",{
    method:"POST",
    headers:{ "Content-Type":"application/json", "Authorization":"Bearer "+getToken() },
    body:JSON.stringify({ session_id:id })
  });
  loadDevices();
}

// INIT
if(getToken()) loginScreen.style.display="none";
openPage("translate");
loadDevices();

</script>
</body>
</html>
